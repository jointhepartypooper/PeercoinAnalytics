var z=Object.defineProperty;var H=(g,s,a)=>s in g?z(g,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):g[s]=a;var j=(g,s,a)=>(H(g,typeof s!="symbol"?s+"":s,a),a);import{c as A,g as K,d as O,r as S,a as E,o as F,b as I,e as w,f as k,u as R,B as J,h as q,i as D,j as W,w as _,k as X,l as L,m as Y,v as Z,n as Q,p as tt,S as B,q as N,s as U,t as et,F as nt,J as st,x as M,y as ot,z as at,_ as rt}from"./index-OGXWZKAu.js";var V={exports:{}};(function(g,s){(function(a,o){o()})(A,function(){function a(e,n){return typeof n>"u"?n={autoBom:!1}:typeof n!="object"&&(console.warn("Deprecated: Expected third argument to be a object"),n={autoBom:!n}),n.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\uFEFF",e],{type:e.type}):e}function o(e,n,f){var t=new XMLHttpRequest;t.open("GET",e),t.responseType="blob",t.onload=function(){c(t.response,n,f)},t.onerror=function(){console.error("could not download file")},t.send()}function r(e){var n=new XMLHttpRequest;n.open("HEAD",e,!1);try{n.send()}catch{}return 200<=n.status&&299>=n.status}function d(e){try{e.dispatchEvent(new MouseEvent("click"))}catch{var n=document.createEvent("MouseEvents");n.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(n)}}var i=typeof window=="object"&&window.window===window?window:typeof self=="object"&&self.self===self?self:typeof A=="object"&&A.global===A?A:void 0,p=i.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),c=i.saveAs||(typeof window!="object"||window!==i?function(){}:"download"in HTMLAnchorElement.prototype&&!p?function(e,n,f){var t=i.URL||i.webkitURL,v=document.createElement("a");n=n||e.name||"download",v.download=n,v.rel="noopener",typeof e=="string"?(v.href=e,v.origin===location.origin?d(v):r(v.href)?o(e,n,f):d(v,v.target="_blank")):(v.href=t.createObjectURL(e),setTimeout(function(){t.revokeObjectURL(v.href)},4e4),setTimeout(function(){d(v)},0))}:"msSaveOrOpenBlob"in navigator?function(e,n,f){if(n=n||e.name||"download",typeof e!="string")navigator.msSaveOrOpenBlob(a(e,f),n);else if(r(e))o(e,n,f);else{var t=document.createElement("a");t.href=e,t.target="_blank",setTimeout(function(){d(t)})}}:function(e,n,f,t){if(t=t||open("","_blank"),t&&(t.document.title=t.document.body.innerText="downloading..."),typeof e=="string")return o(e,n,f);var v=e.type==="application/octet-stream",x=/constructor/i.test(i.HTMLElement)||i.safari,h=/CriOS\/[\d]+/.test(navigator.userAgent);if((h||v&&x||p)&&typeof FileReader<"u"){var y=new FileReader;y.onloadend=function(){var l=y.result;l=h?l:l.replace(/^data:[^;]*;/,"data:attachment/file;"),t?t.location.href=l:location=l,t=null},y.readAsDataURL(e)}else{var T=i.URL||i.webkitURL,u=T.createObjectURL(e);t?t.location=u:location.href=u,t=null,setTimeout(function(){T.revokeObjectURL(u)},4e4)}});i.saveAs=c.saveAs=c,g.exports=c})})(V);var it=V.exports;const lt=K(it),G=365*24*3600,$=24*3600;class ct{constructor(s){j(this,"client");j(this,"Transactions",[]);this.client=s}getTransaction(s){const a=this.Transactions.find(o=>o.txid===s);return a||null}async fetchTransactions(s,a){let o=0;for(let r=0;r<s.length;r++){const d=s[r],i=await this.getRawTransaction(d);i?this.Transactions.push(i):console.log("unable to get raw transaction "+d);let p=100*(r/s.length);p-o>=5&&(o=p,a(o))}return a(100),this.Transactions}isEven(s){return s%2==0}expavgint(s,a){const r=new Date("2020-06-05T01:00:00Z").getTime()/1e3,d=1,i=5;let p=0,c=0;return s<r?(c=c+d*(r-s),p=r):p=s,r<a?c=c+i*(a-p):c=c+d*(a-p),.75*c/(a-s)}async procdata(s,a,o){if(!a)return[];let r=[...a];r.sort((n,f)=>n.blocktime-f.blocktime);const d=[],i=[];for(let n=0;n<r.length;n++){let f=r[n].txid;d.includes(f)||(d.push(f),i.push(n))}const p=[];let c=0,e=0;for(let n=0;n<i.length;n++){let f=i[n],t=r[f],v=0;if(this.isCoinstake(t)){const h=(await this.getRawTransaction(t.vin[0].txid)).vout[t.vin[0].vout].value,y=t.vout[t.vout.length-1].value;v=v+y-h,c=c+v,p.push({date:t.blocktime,amount:v,tag:"Mint by stake",amtTotal:c})}else{for(let h=0;h<t.vout.length;h++)t.vout[h].scriptPubKey.address&&t.vout[h].scriptPubKey.address===s&&(v=v+Number(t.vout[h].value));for(let h=0;h<t.vin.length;h++){const y=t.vin[h],T=await this.getRawTransaction(y.txid),u=y.vout,l=T?T.vout:[],m=T&&l&&l.length>u&&l[u].scriptPubKey.address?l[u].scriptPubKey.address:"";m&&m===s&&(v=v-l[u].value)}c=c+v,p.push({date:t.blocktime,amount:v,tag:"Send/Receive",amtTotal:c});let x=100*(n/i.length);x-e>=5&&(e=x,o(e))}}return o(100),p}datedata(s,a,o){let r=this.calcintrst(s,a,o),d=[],i=[],p=[];r.interest>this.expavgint(s,a)?console.log("You were a CONTINUOUS minter during this period"):console.log("You were a PERIODIC minter during this period");for(let t=s;t<a;t=t+$){let v=this.calcintrst(t-G,t,o);d.push(t),i.push(v.interest);let x=this.calcintrst(s,t,o);p.push(x.rewardpercent)}const c=this.posreward(s,a,o),e=c.posdate,n=c.posreward,f=c.posdatediff;return[{xAxis:d,yAxis:i},{xAxis:d,yAxis:p},{xAxis:e,yAxis:n},{xAxis:e,yAxis:f}]}posreward(s,a,o){const r=[],d=[],i=[];let p=-1;for(let c=0;c<o.length;c++){const e=o[c];if(e.date>s&&e.date<a&&e.tag==="Mint by stake")if(p++,r.push(e.date),d.push(e.amount),p>0){const n=(r[p]-r[p-1])/$;i.push(n)}else i[0]=0}return{posdate:r,posreward:d,posdatediff:i}}calcintrst(s,a,o){let r=0,d=0,i=o.length,p=0;for(let f=0;f<o.length;f++){const t=o[f];t.date>s&&t.date<a&&(p==0&&f>0?r=r+o[f-1].amtTotal*(t.date-s):f+1===i||o[f+1].amtTotal>a?r=r+t.amtTotal*(a-t.amtTotal):r=r+t.amtTotal*(o[f+1].date-t.date),t.tag==="Mint by stake"&&(d=d+t.amount),p=1)}const c=r/(a-s),e=100*d*G/r,n=100*d*(a-s)/(r*1);return{avg:c,reward:d,interest:e,rewardpercent:n}}isCoinstake(s){return s.vin.length===1&&s.vout.length>1&&s.vout[0].value<1e-6}async getRawTransaction(s){try{return s?await this.client.getRawTransactionVerbose(s):null}catch(a){console.error(a)}return null}}const ut={class:"input-group custom-file-button"},dt={class:"input-group-text inputbox clickable",for:"inputGroupFile"},pt=["disabled"],ft=w("span",null,"Import",-1),vt=[ft],ht=O({__name:"FileReader",emits:["text-loaded"],setup(g,{emit:s}){const a=s,o=S(null),r=S(null),d=E(()=>o.value&&o.value.name?o.value.name:""),i=E(()=>d.value.endsWith(".json"));function p(e){!e.target||!e.target.files||(o.value=r.value.files[0])}function c(){if(!i.value)return;const e=new FileReader;e.onload=n=>{n.target&&a("text-loaded",n.target.result)},e.readAsText(o.value)}return(e,n)=>(F(),I("div",ut,[w("label",dt,[k(R(J),{style:{"font-size":"1.5rem",color:"cornflowerblue"}})]),w("input",{type:"file",class:"form-control form-control",id:"inputGroupFile","aria-describedby":"inputGroupFileAddon04","aria-label":"Upload",ref_key:"file",ref:r,onChange:p},null,544),w("button",{class:"btn btn-outline-success",type:"button",id:"inputGroupFileAddon04",disabled:!i.value,onClick:c},vt,8,pt)]))}}),P=g=>(ot("data-v-18da09e7"),g=g(),at(),g),gt=P(()=>w("div",{class:"my-2"},"Get transaction from wallet by address",-1)),mt={class:"input-group"},wt=P(()=>w("span",{class:"input-group-text"},"Address",-1)),bt=["disabled"],yt={class:"progress",style:{height:"2px"}},xt=P(()=>w("div",{class:"my-2"},"or import a previous session",-1)),_t=O({__name:"CollectTransactions",setup(g){const s=q();let a=null;const o=D(),r=W(),d=S(!1),i=S(""),p=S(0),c=S(0),e=E(()=>Math.ceil(.1*(7.5*c.value+2.5*p.value))),n=E(()=>{if(i.value){const u=i.value;return new RegExp(/^(pc1|[Pp])[a-km-zA-HJ-NP-Z1-9]{25,34}$/).test(u)==!0}return!1});async function f(){if(d.value)return;d.value=!0;const u=await x(i.value);if(u&&u.addrStr){const m=await v(u.addrStr,t(),u.transactions);o.clear(),o.address=u.addrStr,o.addTxRange(u.transactions),o.results=m}d.value=!1}function t(){return a||(a=new ct(new st("localhost",r.name,r.password,r.port))),a}async function v(u,l,m){const b=await l.fetchTransactions(m,C=>{p.value=C});return await l.procdata(u,b,C=>{c.value=C})}async function x(u){try{let l=[],m=1,b=(await M.get("https://blockbook.peercoin.net/api/address/"+u+"?page="+m,void 0)).data;if(l=[...l,...b.transactions],b&&b.totalPages>b.page)do m++,b=(await M.get("https://blockbook.peercoin.net/api/address/"+u+"?page="+m,void 0)).data,l=[...l,...b.transactions];while(b.totalPages>b.page);return{addrStr:b.addrStr,transactions:l}}catch(l){console.error(l)}return null}function h(){const u={addrStr:o.address,transactionIds:o.txids,results:o.results},l=JSON.stringify(u,null,2),m=new File([l],(u.addrStr??"myAddress")+".json",{type:"text/plain;charset=utf-8"});lt.saveAs(m)}function y(u){return"addrStr"in u&&"transactionIds"in u&&"results"in u}function T(u){if(!u)return;const l=JSON.parse(u);y(l)?(o.clear(),o.address=l.addrStr,o.addTxRange(l.transactionIds),o.results=l.results,p.value=100,c.value=100):console.warn("This file aint right")}return(u,l)=>(F(),I(nt,null,[k(B,null,{icon:_(()=>[k(R(X))]),heading:_(()=>[L("Transactions")]),default:_(()=>[gt,w("div",mt,[wt,Y(w("input",{id:"peercoinAddressinp",class:Q(["form-control",{invalid:!!i.value&&!n.value}]),type:"text","onUpdate:modelValue":l[0]||(l[0]=m=>i.value=m)},null,2),[[Z,i.value]]),w("button",{disabled:!n.value,class:"btn btn-outline-success",type:"button",onClick:f}," Get transactions ",8,bt)]),w("div",yt,[w("div",{class:"progress-bar bg-success",role:"progressbar",style:tt({width:e.value+"%"}),"aria-valuemin":"0","aria-valuemax":"100"},null,4)]),xt,k(ht,{id:"formFileSmtodo",onTextLoaded:T})]),_:1}),e.value>=100?(F(),N(B,{key:0},{icon:_(()=>[k(R(J))]),heading:_(()=>[L("Export results")]),default:_(()=>[w("button",{type:"button",class:"btn btn-outline-success",onClick:h}," Save ")]),_:1})):U("",!0),e.value>=100?(F(),N(B,{key:1},{icon:_(()=>[k(R(et))]),heading:_(()=>[L("Next tab")]),default:_(()=>[w("button",{type:"button",class:"btn btn-success",onClick:l[1]||(l[1]=m=>R(s).push({name:"charts"}))}," Next ")]),_:1})):U("",!0)],64))}}),Tt=rt(_t,[["__scopeId","data-v-18da09e7"]]),kt={class:"collectTransactions"},Rt=O({__name:"AddressView",setup(g){return(s,a)=>(F(),I("div",kt,[k(Tt)]))}});export{Rt as default};
